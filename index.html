<script>
const msgs = document.getElementById('msgs');
const form = document.getElementById('f');
const input = document.getElementById('t');

function add(text, role='you', extra=''){
  const d=document.createElement('div');
  d.className=`msg ${role} ${extra}`;
  d.textContent=text;
  msgs.appendChild(d);
  msgs.scrollTop=msgs.scrollHeight;
  return d;
}

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  const text=input.value.trim(); if(!text) return;
  add(text,'you'); input.value='';
  const thinking=add('…กำลังคิด…','bot');

  try{
    // เปลี่ยน URL ตรงนี้ให้เป็นของ Worker คุณ
    const workerURL = 'https://your-worker-name.workers.dev/chat';

    // ส่งแบบ POST x-www-form-urlencoded
    let r = await fetch(workerURL, {
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body:'msg='+encodeURIComponent(text)
    });

    // fallback เผื่อโฮสต์แปลกๆ
    if (r.status===405) r = await fetch(`${workerURL}?msg=${encodeURIComponent(text)}`);

    const out = await r.text();
    thinking.remove();
    add(out || 'ไม่ได้รับคำตอบ','bot');
  }catch(err){
    thinking.remove();
    add('เออเรอร์: '+(err?.message||String(err)),'bot');
  }
});
</script>
