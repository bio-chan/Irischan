<script>
const form = document.getElementById('chatForm');
const input = document.getElementById('input');
const messages = document.getElementById('messages');

function addMessage(t, role='you'){
  const d=document.createElement('div');
  d.className='msg '+role; d.textContent=t;
  messages.appendChild(d); messages.scrollTop = messages.scrollHeight;
}

form.addEventListener('submit', async e=>{
  e.preventDefault();
  const text = input.value.trim(); if(!text) return;
  addMessage(text,'you'); input.value='';
  const thinking = document.createElement('div');
  thinking.className='msg bot'; thinking.textContent='...กำลังคิด...';
  messages.appendChild(thinking); messages.scrollTop = messages.scrollHeight;

  try {
    // ลอง POST ก่อน
    let resp = await fetch('chat.php', {
      method:'POST',
      headers:{'Content-Type':'application/x-www-form-urlencoded'},
      body:'msg='+encodeURIComponent(text)
    });
    // ถ้าโฮสต์ไม่รับ POST → 405 ให้ลอง GET
    if (resp.status === 405) {
      resp = await fetch('chat.php?msg='+encodeURIComponent(text));
    }
    const data = await resp.text();
    thinking.remove();
    addMessage(data,'bot');
  } catch (err) {
    thinking.remove();
    addMessage('มีปัญหาในการติดต่อเซิร์ฟเวอร์', 'bot');
  }
});
</script>

